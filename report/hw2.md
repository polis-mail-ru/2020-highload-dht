# Нагрузочное тестирование с помощью wrk2



### 1) Тестирование PUT запросов

Параметры запуска тестов:
1. Thread - 4
2. Connection - 16
3. Requests per second - 40000
4. Duration - 60s

`wrk2 -t4 -c16 -R40000 -d60s -s wrk/put.lua --latency  http://localhost:8080`

Running 1m test @ http://localhost:8080
  4 threads and 16 connections
  
      Thread calibration: mean lat.: 1.256ms, rate sampling interval: 10ms
      Thread calibration: mean lat.: 1.223ms, rate sampling interval: 10ms
      Thread calibration: mean lat.: 1.296ms, rate sampling interval: 10ms
      Thread calibration: mean lat.: 1.301ms, rate sampling interval: 10ms
      Thread Stats   Avg      Stdev     Max   +/- Stdev
        Latency     1.19ms  828.40us  23.28ms   79.49%
        Req/Sec    10.55k     1.04k   19.00k    74.13%
  Latency Distribution (HdrHistogram - Recorded Latency)
      
     50.000%    1.09ms
     75.000%    1.56ms
     90.000%    2.00ms
     99.000%    4.07ms
     99.900%    8.56ms
     99.990%   15.70ms
     99.999%   22.54ms
    100.000%   23.30ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.020     0.000000            1         1.00
       0.340     0.100000       200053         1.11
       0.558     0.200000       400422         1.25
       0.762     0.300000       599887         1.43
       0.936     0.400000       799842         1.67
       1.088     0.500000       999619         2.00
       1.164     0.550000      1100577         2.22
       1.245     0.600000      1199807         2.50
       1.337     0.650000      1299493         2.86
       1.442     0.700000      1399860         3.33
       1.557     0.750000      1499706         4.00
       1.619     0.775000      1549863         4.44
       1.685     0.800000      1599703         5.00
       1.755     0.825000      1649331         5.71
       1.831     0.850000      1699796         6.67
       1.911     0.875000      1749629         8.00
       1.955     0.887500      1774642         8.89
       2.004     0.900000      1799466        10.00
       2.059     0.912500      1824640        11.43
       2.121     0.925000      1849431        13.33
       2.197     0.937500      1874286        16.00
       2.243     0.943750      1886844        17.78
       2.297     0.950000      1899515        20.00
       2.361     0.956250      1911867        22.86
       2.445     0.962500      1924324        26.67
       2.561     0.968750      1936716        32.00
       2.643     0.971875      1943047        35.56
       2.743     0.975000      1949235        40.00
       2.883     0.978125      1955531        45.71
       3.071     0.981250      1961713        53.33
       3.337     0.984375      1967973        64.00
       3.497     0.985938      1971108        71.11
       3.691     0.987500      1974220        80.00
       3.919     0.989062      1977331        91.43
       4.183     0.990625      1980452       106.67
       4.495     0.992188      1983578       128.00
       4.679     0.992969      1985126       142.22
       4.903     0.993750      1986710       160.00
       5.131     0.994531      1988256       182.86
       5.411     0.995313      1989813       213.33
       5.747     0.996094      1991386       256.00
       5.951     0.996484      1992162       284.44
       6.191     0.996875      1992940       320.00
       6.467     0.997266      1993721       365.71
       6.755     0.997656      1994494       426.67
       7.147     0.998047      1995280       512.00
       7.375     0.998242      1995668       568.89
       7.635     0.998437      1996057       640.00
       7.907     0.998633      1996447       731.43
       8.223     0.998828      1996843       853.33
       8.607     0.999023      1997228      1024.00
       8.839     0.999121      1997427      1137.78
       9.079     0.999219      1997619      1280.00
       9.359     0.999316      1997813      1462.86
       9.695     0.999414      1998013      1706.67
      10.127     0.999512      1998204      2048.00
      10.399     0.999561      1998303      2275.56
      10.615     0.999609      1998399      2560.00
      10.951     0.999658      1998496      2925.71
      11.439     0.999707      1998594      3413.33
      12.239     0.999756      1998691      4096.00
      12.759     0.999780      1998740      4551.11
      13.311     0.999805      1998789      5120.00
      13.967     0.999829      1998838      5851.43
      14.527     0.999854      1998887      6826.67
      15.151     0.999878      1998935      8192.00
      15.479     0.999890      1998960      9102.22
      15.727     0.999902      1998984     10240.00
      16.055     0.999915      1999009     11702.86
      16.447     0.999927      1999033     13653.33
      16.863     0.999939      1999057     16384.00
      17.151     0.999945      1999071     18204.44
      17.375     0.999951      1999082     20480.00
      17.599     0.999957      1999094     23405.71
      17.935     0.999963      1999106     27306.67
      18.255     0.999969      1999118     32768.00
      18.687     0.999973      1999125     36408.89
      19.119     0.999976      1999131     40960.00
      20.367     0.999979      1999137     46811.43
      21.455     0.999982      1999143     54613.33
      21.903     0.999985      1999149     65536.00
      21.967     0.999986      1999152     72817.78
      22.207     0.999988      1999155     81920.00
      22.415     0.999989      1999158     93622.86
      22.607     0.999991      1999162    109226.67
      22.703     0.999992      1999164    131072.00
      22.735     0.999993      1999166    145635.56
      22.751     0.999994      1999167    163840.00
      22.927     0.999995      1999170    187245.71
      22.927     0.999995      1999170    218453.33
      22.991     0.999996      1999172    262144.00
      23.135     0.999997      1999173    291271.11
      23.135     0.999997      1999173    327680.00
      23.151     0.999997      1999175    374491.43
      23.151     0.999998      1999175    436906.67
      23.167     0.999998      1999177    524288.00
      23.167     0.999998      1999177    582542.22
      23.167     0.999998      1999177    655360.00
      23.167     0.999999      1999177    748982.86
      23.167     0.999999      1999177    873813.33
      23.215     0.999999      1999178   1048576.00
      23.215     0.999999      1999178   1165084.44
      23.215     0.999999      1999178   1310720.00
      23.215     0.999999      1999178   1497965.71
      23.215     0.999999      1999178   1747626.67
      23.295     1.000000      1999179   2097152.00
      23.295     1.000000      1999179          inf

    [Mean    =        1.187, StdDeviation   =        0.828]
    [Max     =       23.280, Total count    =      1999179]
    [Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  2399640 requests in 1.00m, 153.33MB read
  
    Requests/sec:  39994.18
    Transfer/sec:      2.56MB


#### Результаты профилирования async-profiler (CPU): 
![Результаты профилирования async-profiler (CPU)](profilingResults/cpu_put_hw2.svg)

Анализ: 
 - Обработка запроса: 74.41%
 - Запись в сокет: 33.92%
 - Чтение из сокета: 13.35%
 - Вставка в ConcurrentSkipListMap - Memory Table в DAO занимает - 9.87%
 - Flush в 4 потока занимает - 7.42%%
 
#### Результаты профилирования async-profiler (ALLOC):
 
`wrk2 -t4 -c16 -R40000 -d60s -s wrk/put.lua --latency  http://localhost:8080`

Running 1m test @ http://localhost:8080
  4 threads and 16 connections
      
      Thread calibration: mean lat.: 1.171ms, rate sampling interval: 10ms
      Thread calibration: mean lat.: 1.180ms, rate sampling interval: 10ms
      Thread calibration: mean lat.: 1.184ms, rate sampling interval: 10ms
      Thread calibration: mean lat.: 1.176ms, rate sampling interval: 10ms
      Thread Stats   Avg      Stdev     Max   +/- Stdev
        Latency     1.23ms    1.07ms  28.88ms   92.48%
        Req/Sec    10.55k     1.09k   20.56k    77.02%
  Latency Distribution (HdrHistogram - Recorded Latency)
      
     50.000%    1.11ms
     75.000%    1.59ms
     90.000%    1.99ms
     99.000%    4.70ms
     99.900%   14.30ms
     99.990%   23.95ms
     99.999%   27.26ms
    100.000%   28.90ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.017     0.000000            1         1.00
       0.338     0.100000       200055         1.11
       0.572     0.200000       399899         1.25
       0.790     0.300000       600231         1.43
       0.962     0.400000       799765         1.67
       1.110     0.500000      1000020         2.00
       1.185     0.550000      1099933         2.22
       1.269     0.600000      1200151         2.50
       1.363     0.650000      1299771         2.86
       1.469     0.700000      1399629         3.33
       1.585     0.750000      1499884         4.00
       1.645     0.775000      1549967         4.44
       1.707     0.800000      1599366         5.00
       1.773     0.825000      1649806         5.71
       1.840     0.850000      1699712         6.67
       1.911     0.875000      1749703         8.00
       1.950     0.887500      1774259         8.89
       1.994     0.900000      1799504        10.00
       2.042     0.912500      1824404        11.43
       2.099     0.925000      1849945        13.33
       2.169     0.937500      1874835        16.00
       2.213     0.943750      1887127        17.78
       2.267     0.950000      1899532        20.00
       2.335     0.956250      1911723        22.86
       2.433     0.962500      1924392        26.67
       2.575     0.968750      1936814        32.00
       2.677     0.971875      1942955        35.56
       2.821     0.975000      1949210        40.00
       3.021     0.978125      1955440        45.71
       3.305     0.981250      1961698        53.33
       3.675     0.984375      1967933        64.00
       3.895     0.985938      1971056        71.11
       4.155     0.987500      1974203        80.00
       4.475     0.989062      1977305        91.43
       4.871     0.990625      1980439       106.67
       5.395     0.992188      1983554       128.00
       5.723     0.992969      1985122       142.22
       6.147     0.993750      1986681       160.00
       6.659     0.994531      1988235       182.86
       7.283     0.995313      1989796       213.33
       8.039     0.996094      1991356       256.00
       8.455     0.996484      1992143       284.44
       8.887     0.996875      1992922       320.00
       9.471     0.997266      1993705       365.71
      10.071     0.997656      1994480       426.67
      10.783     0.998047      1995262       512.00
      11.223     0.998242      1995652       568.89
      11.815     0.998437      1996041       640.00
      12.511     0.998633      1996437       731.43
      13.239     0.998828      1996822       853.33
      14.487     0.999023      1997212      1024.00
      15.335     0.999121      1997407      1137.78
      16.223     0.999219      1997603      1280.00
      16.975     0.999316      1997802      1462.86
      17.839     0.999414      1997993      1706.67
      18.831     0.999512      1998191      2048.00
      19.263     0.999561      1998286      2275.56
      19.791     0.999609      1998390      2560.00
      20.175     0.999658      1998481      2925.71
      20.655     0.999707      1998580      3413.33
      21.487     0.999756      1998676      4096.00
      22.047     0.999780      1998725      4551.11
      22.447     0.999805      1998775      5120.00
      22.863     0.999829      1998824      5851.43
      23.119     0.999854      1998872      6826.67
      23.535     0.999878      1998921      8192.00
      23.759     0.999890      1998947      9102.22
      24.047     0.999902      1998969     10240.00
      24.383     0.999915      1998994     11702.86
      24.687     0.999927      1999018     13653.33
      25.007     0.999939      1999043     16384.00
      25.199     0.999945      1999055     18204.44
      25.359     0.999951      1999067     20480.00
      25.471     0.999957      1999079     23405.71
      25.647     0.999963      1999091     27306.67
      25.839     0.999969      1999104     32768.00
      26.015     0.999973      1999110     36408.89
      26.159     0.999976      1999117     40960.00
      26.287     0.999979      1999122     46811.43
      26.607     0.999982      1999128     54613.33
      26.815     0.999985      1999134     65536.00
      26.975     0.999986      1999137     72817.78
      27.071     0.999988      1999140     81920.00
      27.231     0.999989      1999143     93622.86
      27.311     0.999991      1999146    109226.67
      27.487     0.999992      1999149    131072.00
      27.551     0.999993      1999151    145635.56
      27.647     0.999994      1999152    163840.00
      27.711     0.999995      1999154    187245.71
      27.727     0.999995      1999155    218453.33
      27.759     0.999996      1999157    262144.00
      27.935     0.999997      1999158    291271.11
      27.935     0.999997      1999158    327680.00
      27.983     0.999997      1999159    374491.43
      28.047     0.999998      1999160    436906.67
      28.175     0.999998      1999161    524288.00
      28.175     0.999998      1999161    582542.22
      28.175     0.999998      1999161    655360.00
      28.335     0.999999      1999162    748982.86
      28.335     0.999999      1999162    873813.33
      28.655     0.999999      1999163   1048576.00
      28.655     0.999999      1999163   1165084.44
      28.655     0.999999      1999163   1310720.00
      28.655     0.999999      1999163   1497965.71
      28.655     0.999999      1999163   1747626.67
      28.895     1.000000      1999164   2097152.00
      28.895     1.000000      1999164          inf
      
    [Mean    =        1.230, StdDeviation   =        1.070]
    [Max     =       28.880, Total count    =      1999164]
    [Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  2399626 requests in 1.00m, 153.33MB read
    
    Requests/sec:  39993.90
    Transfer/sec:      2.56MB


#### Результаты профилирования async-profiler (ALLOC): 
![Результаты профилирования async-profiler (ALLOC)](profilingResults/alloc_put_hw2.svg)

Анализ:
 - HttpBuffer занимает - 92.37%
 - BasicService.upsert занимает - 30.94%
 - Dao.upsert занимает - 10.37%
 - Response - 6.81%
 - Parse Http Request - 19.73%
 - Request - 5.93%
 - Flush - 4.50%
 
 
  
#### Результаты профилирования async-profiler (LOCK):
 
`wrk2 -t4 -c16 -R40000 -d60s -s wrk/put.lua --latency  http://localhost:8080`

Running 1m test @ http://localhost:8080
  4 threads and 16 connections
  
      Thread calibration: mean lat.: 1.192ms, rate sampling interval: 10ms
      Thread calibration: mean lat.: 1.189ms, rate sampling interval: 10ms
      Thread calibration: mean lat.: 1.172ms, rate sampling interval: 10ms
      Thread calibration: mean lat.: 1.218ms, rate sampling interval: 10ms
      Thread Stats   Avg      Stdev     Max   +/- Stdev
        Latency     1.21ms    0.94ms  33.63ms   86.33%
        Req/Sec    10.54k     1.06k   20.40k    76.45%
  Latency Distribution (HdrHistogram - Recorded Latency)
  
     50.000%    1.11ms
     75.000%    1.58ms
     90.000%    2.00ms
     99.000%    4.28ms
     99.900%   10.15ms
     99.990%   25.82ms
     99.999%   29.06ms
    100.000%   33.66ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.019     0.000000            1         1.00
       0.341     0.100000       200159         1.11
       0.571     0.200000       399868         1.25
       0.786     0.300000       600227         1.43
       0.959     0.400000       800212         1.67
       1.109     0.500000      1000492         2.00
       1.185     0.550000      1100347         2.22
       1.267     0.600000      1199912         2.50
       1.361     0.650000      1300071         2.86
       1.465     0.700000      1399577         3.33
       1.580     0.750000      1499425         4.00
       1.640     0.775000      1549418         4.44
       1.704     0.800000      1599945         5.00
       1.770     0.825000      1649723         5.71
       1.839     0.850000      1699979         6.67
       1.911     0.875000      1749813         8.00
       1.951     0.887500      1774815         8.89
       1.995     0.900000      1799807        10.00
       2.043     0.912500      1824502        11.43
       2.099     0.925000      1849843        13.33
       2.167     0.937500      1874500        16.00
       2.211     0.943750      1887218        17.78
       2.261     0.950000      1899327        20.00
       2.327     0.956250      1912008        22.86
       2.413     0.962500      1924395        26.67
       2.539     0.968750      1936751        32.00
       2.629     0.971875      1942983        35.56
       2.747     0.975000      1949259        40.00
       2.907     0.978125      1955534        45.71
       3.127     0.981250      1961743        53.33
       3.429     0.984375      1967980        64.00
       3.619     0.985938      1971105        71.11
       3.833     0.987500      1974229        80.00
       4.091     0.989062      1977362        91.43
       4.411     0.990625      1980489       106.67
       4.799     0.992188      1983595       128.00
       5.047     0.992969      1985158       142.22
       5.323     0.993750      1986727       160.00
       5.639     0.994531      1988288       182.86
       6.015     0.995313      1989850       213.33
       6.475     0.996094      1991414       256.00
       6.743     0.996484      1992187       284.44
       7.047     0.996875      1992966       320.00
       7.391     0.997266      1993753       365.71
       7.779     0.997656      1994534       426.67
       8.239     0.998047      1995317       512.00
       8.471     0.998242      1995700       568.89
       8.767     0.998437      1996094       640.00
       9.127     0.998633      1996483       731.43
       9.591     0.998828      1996867       853.33
      10.255     0.999023      1997258      1024.00
      10.743     0.999121      1997455      1137.78
      11.303     0.999219      1997650      1280.00
      11.863     0.999316      1997844      1462.86
      12.471     0.999414      1998040      1706.67
      13.255     0.999512      1998233      2048.00
      13.807     0.999561      1998333      2275.56
      14.735     0.999609      1998429      2560.00
      15.775     0.999658      1998526      2925.71
      17.231     0.999707      1998624      3413.33
      19.631     0.999756      1998722      4096.00
      20.991     0.999780      1998770      4551.11
      22.223     0.999805      1998819      5120.00
      23.663     0.999829      1998868      5851.43
      24.303     0.999854      1998919      6826.67
      24.799     0.999878      1998966      8192.00
      25.423     0.999890      1998991      9102.22
      25.855     0.999902      1999014     10240.00
      26.047     0.999915      1999040     11702.86
      26.255     0.999927      1999065     13653.33
      26.559     0.999939      1999088     16384.00
      26.671     0.999945      1999101     18204.44
      26.895     0.999951      1999113     20480.00
      27.055     0.999957      1999124     23405.71
      27.327     0.999963      1999137     27306.67
      27.439     0.999969      1999148     32768.00
      27.551     0.999973      1999157     36408.89
      27.663     0.999976      1999161     40960.00
      27.743     0.999979      1999168     46811.43
      27.887     0.999982      1999173     54613.33
      28.223     0.999985      1999179     65536.00
      28.351     0.999986      1999182     72817.78
      28.831     0.999988      1999185     81920.00
      28.975     0.999989      1999188     93622.86
      29.343     0.999991      1999191    109226.67
      30.079     0.999992      1999194    131072.00
      30.575     0.999993      1999196    145635.56
      30.863     0.999994      1999197    163840.00
      31.311     0.999995      1999199    187245.71
      31.503     0.999995      1999200    218453.33
      31.999     0.999996      1999202    262144.00
      32.303     0.999997      1999203    291271.11
      32.303     0.999997      1999203    327680.00
      32.543     0.999997      1999204    374491.43
      32.799     0.999998      1999205    436906.67
      32.959     0.999998      1999206    524288.00
      32.959     0.999998      1999206    582542.22
      32.959     0.999998      1999206    655360.00
      33.183     0.999999      1999207    748982.86
      33.183     0.999999      1999207    873813.33
      33.439     0.999999      1999208   1048576.00
      33.439     0.999999      1999208   1165084.44
      33.439     0.999999      1999208   1310720.00
      33.439     0.999999      1999208   1497965.71
      33.439     0.999999      1999208   1747626.67
      33.663     1.000000      1999209   2097152.00
      33.663     1.000000      1999209          inf
      
    [Mean    =        1.210, StdDeviation   =        0.937]
    [Max     =       33.632, Total count    =      1999209]
    [Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  2399658 requests in 1.00m, 153.33MB read
  
    Requests/sec:  39993.76
    Transfer/sec:      2.56MB


#### Результаты профилирования async-profiler (LOCK): 
![Результаты профилирования async-profiler (LOCK)](profilingResults/lock_put_hw2.svg)

Анализ:
 - ReentrantReadWriteLock.ReadLock - 85.71%
 - ReentrantReadWriteLock.WriteLock - 14.29%

Ожидание ReentrantReadWriteLock.ReadLock, происходит при flush'e очередного `memory table` на диск.
Ожидание ReentrantReadWriteLock.WriteLock, происходит при желании записать на диск, но, когда в этот момент в `memory table` 
вставляют, удаляют, обновляют значения другие потоки.


### 2) Тестирование GET запросов

Параметры запуска тестов:
1. Thread - 4
2. Connection - 16
3. Requests per second - 2000
4. Duration - 60s

`wrk2 -t4 -c16 -R2000 -d60s -s wrk/get.lua --latency  http://localhost:8080`

Running 1m test @ http://localhost:8080
  4 threads and 16 connections
      
      Thread calibration: mean lat.: 23.382ms, rate sampling interval: 79ms
      Thread calibration: mean lat.: 16.052ms, rate sampling interval: 63ms
      Thread calibration: mean lat.: 16.421ms, rate sampling interval: 54ms
      Thread calibration: mean lat.: 13.859ms, rate sampling interval: 20ms
      Thread Stats   Avg      Stdev     Max   +/- Stdev
        Latency     3.03ms    4.91ms  77.89ms   95.42%
        Req/Sec   508.46     58.46     1.16k    83.05%
  Latency Distribution (HdrHistogram - Recorded Latency)
  
     50.000%    2.08ms
     75.000%    2.58ms
     90.000%    3.29ms
     99.000%   30.72ms
     99.900%   52.74ms
     99.990%   66.24ms
     99.999%   76.80ms
    100.000%   77.95ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.742     0.000000            1         1.00
       1.326     0.100000        10003         1.11
       1.559     0.200000        19992         1.25
       1.750     0.300000        30031         1.43
       1.918     0.400000        40033         1.67
       2.079     0.500000        50065         2.00
       2.159     0.550000        55054         2.22
       2.253     0.600000        60055         2.50
       2.353     0.650000        65078         2.86
       2.455     0.700000        69977         3.33
       2.577     0.750000        75009         4.00
       2.645     0.775000        77505         4.44
       2.719     0.800000        80003         5.00
       2.803     0.825000        82464         5.71
       2.913     0.850000        84971         6.67
       3.057     0.875000        87477         8.00
       3.155     0.887500        88715         8.89
       3.287     0.900000        89961        10.00
       3.489     0.912500        91210        11.43
       3.831     0.925000        92462        13.33
       4.739     0.937500        93713        16.00
       5.607     0.943750        94334        17.78
       6.771     0.950000        94960        20.00
       8.583     0.956250        95584        22.86
      10.367     0.962500        96209        26.67
      12.455     0.968750        96836        32.00
      13.711     0.971875        97145        35.56
      15.047     0.975000        97458        40.00
      16.543     0.978125        97770        45.71
      18.703     0.981250        98082        53.33
      21.759     0.984375        98396        64.00
      23.903     0.985938        98552        71.11
      26.127     0.987500        98707        80.00
      29.055     0.989062        98864        91.43
      32.111     0.990625        99019       106.67
      35.519     0.992188        99176       128.00
      37.567     0.992969        99254       142.22
      39.071     0.993750        99332       160.00
      40.639     0.994531        99410       182.86
      42.111     0.995313        99488       213.33
      43.903     0.996094        99567       256.00
      44.927     0.996484        99606       284.44
      45.727     0.996875        99645       320.00
      46.687     0.997266        99685       365.71
      47.743     0.997656        99723       426.67
      48.895     0.998047        99761       512.00
      49.439     0.998242        99782       568.89
      50.111     0.998437        99801       640.00
      50.783     0.998633        99820       731.43
      51.743     0.998828        99841       853.33
      53.023     0.999023        99859      1024.00
      53.759     0.999121        99870      1137.78
      54.399     0.999219        99878      1280.00
      55.167     0.999316        99888      1462.86
      55.807     0.999414        99898      1706.67
      56.799     0.999512        99908      2048.00
      57.631     0.999561        99913      2275.56
      58.175     0.999609        99917      2560.00
      59.231     0.999658        99922      2925.71
      60.607     0.999707        99927      3413.33
      61.471     0.999756        99932      4096.00
      61.695     0.999780        99935      4551.11
      62.207     0.999805        99937      5120.00
      62.783     0.999829        99939      5851.43
      64.831     0.999854        99942      6826.67
      65.311     0.999878        99944      8192.00
      66.239     0.999890        99946      9102.22
      67.071     0.999902        99947     10240.00
      67.455     0.999915        99948     11702.86
      69.247     0.999927        99949     13653.33
      70.079     0.999939        99950     16384.00
      71.167     0.999945        99951     18204.44
      71.487     0.999951        99952     20480.00
      71.487     0.999957        99952     23405.71
      73.855     0.999963        99953     27306.67
      73.855     0.999969        99953     32768.00
      74.047     0.999973        99954     36408.89
      74.047     0.999976        99954     40960.00
      74.047     0.999979        99954     46811.43
      76.799     0.999982        99955     54613.33
      76.799     0.999985        99955     65536.00
      76.799     0.999986        99955     72817.78
      76.799     0.999988        99955     81920.00
      76.799     0.999989        99955     93622.86
      77.951     0.999991        99956    109226.67
      77.951     1.000000        99956          inf
      
    [Mean    =        3.026, StdDeviation   =        4.915]
    [Max     =       77.888, Total count    =        99956]
    [Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  119990 requests in 1.00m, 8.42MB read

    Requests/sec:   1999.77
    Transfer/sec:    143.73KB


#### Результаты профилирования async-profiler (CPU): 
![Результаты профилирования async-profiler (CPU)](profilingResults/cpu_get_hw2.svg)

Анализ:
 - DAO.get занимает - 97.12%
 - DAO.iterator занимает 93.23%
 - Merge различных iterator'ов занимает - 13.47%
 - 79.31% CPU тратится на то, чтобы бинарным поиском найти место в файле,
 с которого нужно читать, из которых 28.12% - это чтение смещений из файла, и еще 47.73% чтение
 остальных данных

#### Результаты профилирования async-profiler (ALLOC): 

`wrk2 -t4 -c16 -R2000 -d60s -s wrk/get.lua --latency  http://localhost:8080`

Running 1m test @ http://localhost:8080
  4 threads and 16 connections
      
      Thread calibration: mean lat.: 2.433ms, rate sampling interval: 10ms
      Thread calibration: mean lat.: 2.388ms, rate sampling interval: 10ms
      Thread calibration: mean lat.: 2.302ms, rate sampling interval: 10ms
      Thread calibration: mean lat.: 2.556ms, rate sampling interval: 10ms
      Thread Stats   Avg      Stdev     Max   +/- Stdev
        Latency     2.60ms    3.47ms  58.21ms   96.53%
        Req/Sec   526.70     95.26     1.55k    75.77%
  Latency Distribution (HdrHistogram - Recorded Latency)
  
     50.000%    2.03ms
     75.000%    2.49ms
     90.000%    3.12ms
     99.000%   18.93ms
     99.900%   47.01ms
     99.990%   54.62ms
     99.999%   57.85ms
    100.000%   58.24ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.773     0.000000            1         1.00
       1.342     0.100000        10002         1.11
       1.563     0.200000        20012         1.25
       1.737     0.300000        30018         1.43
       1.887     0.400000        40018         1.67
       2.031     0.500000        50008         2.00
       2.107     0.550000        55031         2.22
       2.183     0.600000        59982         2.50
       2.273     0.650000        65029         2.86
       2.375     0.700000        70044         3.33
       2.493     0.750000        75008         4.00
       2.557     0.775000        77519         4.44
       2.631     0.800000        79978         5.00
       2.717     0.825000        82491         5.71
       2.819     0.850000        85011         6.67
       2.945     0.875000        87492         8.00
       3.023     0.887500        88729         8.89
       3.115     0.900000        89974        10.00
       3.231     0.912500        91212        11.43
       3.387     0.925000        92466        13.33
       3.617     0.937500        93711        16.00
       3.797     0.943750        94338        17.78
       4.085     0.950000        94962        20.00
       4.543     0.956250        95585        22.86
       5.507     0.962500        96211        26.67
       6.883     0.968750        96834        32.00
       7.711     0.971875        97147        35.56
       8.751     0.975000        97462        40.00
      10.143     0.978125        97771        45.71
      11.895     0.981250        98086        53.33
      13.983     0.984375        98396        64.00
      14.959     0.985938        98552        71.11
      16.311     0.987500        98708        80.00
      17.823     0.989062        98864        91.43
      19.695     0.990625        99020       106.67
      22.031     0.992188        99177       128.00
      23.343     0.992969        99255       142.22
      25.087     0.993750        99333       160.00
      27.119     0.994531        99411       182.86
      30.047     0.995313        99490       213.33
      32.863     0.996094        99567       256.00
      34.847     0.996484        99606       284.44
      36.703     0.996875        99645       320.00
      39.039     0.997266        99684       365.71
      40.383     0.997656        99723       426.67
      41.951     0.998047        99762       512.00
      42.655     0.998242        99782       568.89
      43.839     0.998437        99802       640.00
      44.639     0.998633        99821       731.43
      45.375     0.998828        99840       853.33
      47.327     0.999023        99861      1024.00
      48.063     0.999121        99870      1137.78
      48.607     0.999219        99879      1280.00
      49.087     0.999316        99889      1462.86
      49.791     0.999414        99899      1706.67
      50.623     0.999512        99909      2048.00
      50.847     0.999561        99914      2275.56
      51.039     0.999609        99919      2560.00
      51.903     0.999658        99923      2925.71
      52.415     0.999707        99928      3413.33
      52.895     0.999756        99933      4096.00
      53.055     0.999780        99936      4551.11
      53.599     0.999805        99939      5120.00
      53.695     0.999829        99940      5851.43
      53.983     0.999854        99943      6826.67
      54.175     0.999878        99945      8192.00
      54.623     0.999890        99947      9102.22
      54.751     0.999902        99948     10240.00
      54.783     0.999915        99949     11702.86
      54.975     0.999927        99950     13653.33
      55.295     0.999939        99951     16384.00
      55.711     0.999945        99952     18204.44
      55.935     0.999951        99953     20480.00
      55.935     0.999957        99953     23405.71
      56.127     0.999963        99954     27306.67
      56.127     0.999969        99954     32768.00
      57.151     0.999973        99955     36408.89
      57.151     0.999976        99955     40960.00
      57.151     0.999979        99955     46811.43
      57.855     0.999982        99956     54613.33
      57.855     0.999985        99956     65536.00
      57.855     0.999986        99956     72817.78
      57.855     0.999988        99956     81920.00
      57.855     0.999989        99956     93622.86
      58.239     0.999991        99957    109226.67
      58.239     1.000000        99957          inf
      
    [Mean    =        2.604, StdDeviation   =        3.471]
    [Max     =       58.208, Total count    =        99957]
    [Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  119988 requests in 1.00m, 8.42MB read
  
    Requests/sec:   1999.71
    Transfer/sec:    143.72KB

#### Результаты профилирования async-profiler (ALLOC): 
![Результаты профилирования async-profiler (ALLOC)](profilingResults/alloc_get_hw2.svg)

Анализ:
 - HttpBuffer занимает - 99.1%
 - Merge Iterator и его Priority Queue занимают - 21.71%
 - BasicService.get занимает - 97.76%
 - Dao.get занимает - 96.9%
 - SSTable.iterator - 60.45%, при этом в основном память выделяется под байтовый буфер для 
 текущего ключа в бинарном поиске, где 48.75% выделяется под сам ключ, а 10.99% на смещение
 до него 
 - Transformed.iterator - 11.33%
 
 #### Результаты профилирования async-profiler (LOCK): 
 
 `wrk2 -t4 -c16 -R2000 -d60s -s wrk/get.lua --latency  http://localhost:8080`

Running 1m test @ http://localhost:8080
  4 threads and 16 connections
      
      Thread calibration: mean lat.: 3.804ms, rate sampling interval: 10ms
      Thread calibration: mean lat.: 4.328ms, rate sampling interval: 12ms
      Thread calibration: mean lat.: 3.754ms, rate sampling interval: 10ms
      Thread calibration: mean lat.: 2.527ms, rate sampling interval: 10ms
      Thread Stats   Avg      Stdev     Max   +/- Stdev
        Latency     3.60ms    1.26ms  23.17ms   74.81%
        Req/Sec   525.55     72.22     0.89k    61.93%
  Latency Distribution (HdrHistogram - Recorded Latency)
 
     50.000%    3.58ms
     75.000%    4.29ms
     90.000%    5.08ms
     99.000%    7.12ms
     99.900%    8.45ms
     99.990%   13.01ms
     99.999%   18.88ms
    100.000%   23.18ms

  Detailed Percentile spectrum:
  
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.044     0.000000            1         1.00
       2.087     0.100000        10012         1.11
       2.729     0.200000        19995         1.25
       3.061     0.300000        30023         1.43
       3.333     0.400000        40024         1.67
       3.583     0.500000        50003         2.00
       3.707     0.550000        54998         2.22
       3.833     0.600000        60013         2.50
       3.969     0.650000        65001         2.86
       4.119     0.700000        69997         3.33
       4.287     0.750000        75035         4.00
       4.379     0.775000        77483         4.44
       4.483     0.800000        79999         5.00
       4.595     0.825000        82491         5.71
       4.727     0.850000        85026         6.67
       4.887     0.875000        87488         8.00
       4.975     0.887500        88737         8.89
       5.079     0.900000        89963        10.00
       5.199     0.912500        91203        11.43
       5.331     0.925000        92452        13.33
       5.475     0.937500        93704        16.00
       5.567     0.943750        94325        17.78
       5.667     0.950000        94962        20.00
       5.779     0.956250        95593        22.86
       5.907     0.962500        96215        26.67
       6.059     0.968750        96833        32.00
       6.147     0.971875        97136        35.56
       6.259     0.975000        97454        40.00
       6.395     0.978125        97764        45.71
       6.543     0.981250        98075        53.33
       6.723     0.984375        98387        64.00
       6.815     0.985938        98539        71.11
       6.931     0.987500        98696        80.00
       7.055     0.989062        98856        91.43
       7.167     0.990625        99010       106.67
       7.299     0.992188        99166       128.00
       7.375     0.992969        99242       142.22
       7.435     0.993750        99322       160.00
       7.551     0.994531        99400       182.86
       7.635     0.995313        99477       213.33
       7.739     0.996094        99555       256.00
       7.803     0.996484        99593       284.44
       7.887     0.996875        99632       320.00
       7.963     0.997266        99671       365.71
       8.015     0.997656        99710       426.67
       8.103     0.998047        99750       512.00
       8.175     0.998242        99770       568.89
       8.271     0.998437        99788       640.00
       8.343     0.998633        99810       731.43
       8.407     0.998828        99829       853.33
       8.463     0.999023        99850      1024.00
       8.511     0.999121        99857      1137.78
       8.583     0.999219        99866      1280.00
       8.711     0.999316        99876      1462.86
       8.879     0.999414        99886      1706.67
       9.103     0.999512        99896      2048.00
       9.271     0.999561        99901      2275.56
       9.415     0.999609        99905      2560.00
       9.759     0.999658        99910      2925.71
      10.111     0.999707        99915      3413.33
      10.575     0.999756        99920      4096.00
      10.807     0.999780        99923      4551.11
      11.167     0.999805        99926      5120.00
      11.415     0.999829        99927      5851.43
      11.567     0.999854        99930      6826.67
      12.127     0.999878        99932      8192.00
      13.007     0.999890        99934      9102.22
      13.439     0.999902        99935     10240.00
      14.111     0.999915        99936     11702.86
      14.639     0.999927        99937     13653.33
      15.167     0.999939        99938     16384.00
      15.863     0.999945        99939     18204.44
      16.943     0.999951        99940     20480.00
      16.943     0.999957        99940     23405.71
      17.583     0.999963        99941     27306.67
      17.583     0.999969        99941     32768.00
      18.399     0.999973        99942     36408.89
      18.399     0.999976        99942     40960.00
      18.399     0.999979        99942     46811.43
      18.879     0.999982        99943     54613.33
      18.879     0.999985        99943     65536.00
      18.879     0.999986        99943     72817.78
      18.879     0.999988        99943     81920.00
      18.879     0.999989        99943     93622.86
      23.183     0.999991        99944    109226.67
      23.183     1.000000        99944          inf
      
    [Mean    =        3.596, StdDeviation   =        1.260]
    [Max     =       23.168, Total count    =        99944]
    [Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  119974 requests in 1.00m, 8.42MB read

    Requests/sec:   1999.59
    Transfer/sec:    143.71KB

#### Результаты профилирования async-profiler (LOCK): 
![Результаты профилирования async-profiler (LOCK)](profilingResults/lock_get_hw2.svg)

Анализ:
 - 55.19% - SSTable iterator
 - MergeIterator - 15.8%, что также является блокировкой файлов
 - TransformedIterator - 9.52%, что также является блокировкой файлов
 
Из анализа видно, что все время занимают блокировки в файлах
 
