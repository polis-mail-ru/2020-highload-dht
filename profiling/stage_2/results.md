# Многопоточность
Так как на этом этапе изменений было мало (в прошлом отчете я уже писала что RocksDB потокобезопасная сама по себе), 
анализ не представляет никакого интереса, так как картина та же самая (в целом).

## Параметры машины
1,2 GHz 4‑ядерный процессор Intel Core i7

## VisualVM
#### Вкладка Threads:
![Screen from visual vm threads](visual-vm-threads.png?raw=true "Screen from visual vm threads")
Тут ничего с прошлого этапа не поменялось. 8 selector-ов, acceptor, RMI.

#### Вкладка Monitor:
![Screen from visual vm monitor](visual-vm-monitor.jpeg?raw=true "Screen from visual vm monitor")
Тут можно посмотреть как растет потребление CPU при увеличении постоянной пропускной способности:


##### PUT-ы:

| цвет       | нагрузка | CPU |
| ------------- |:------------------:| -----:|
| красный   | 1000  | 3% |
| фиолетовый     | 10000 |   19%|
| синий | 48993         |    55% |

##### GET-ы:

| цвет       | нагрузка | CPU |
| ------------- |:------------------:| -----:|
| аквамарин?!   | 1000  | 2% |
| зеленый     | 10000 |   12%|
| желтый | 70697         |    30% |


В общем, линейно возрастает. 

Результаты wrk и async profiler-а можно увидеть ниже.



## PUT
### 1
Запускаю wrk c такими параметрами:
+ 4 threads (worker) send requests
+ keeping 16 HTTP connections open
+ 30 seconds
+ constant throughput of 10000 requests per second

Результаты с async profiler-а (CPU):
![Flame graph from async profiler](put-cpu-4-16-30-10000.svg?raw=true "Flame graph from async profiler")
Все 8 selector-ов обрабатывают запросы. Все остальное не изменилось. 

Результаты с async profiler-а (ALLOC):
![Flame graph from async profiler](put-alloc-4-16-30-10000.svg?raw=true "Flame graph from async profiler")
2% RMI - потому что я смотрю графики на Visual VM. Все то же самое, как и в прошлом отчете. Только "башенки" теперь 
заканчиваются методами из класса ByteBufferConverter (жонглирования байтами для перехода на новую версию RocksDB).

Результаты с async profiler-а (LOCK):
![Flame graph from async profiler](put-lock-4-16-30-10000.svg?raw=true "Flame graph from async profiler")
График пустой. В реализации нет никаких локов. Это хорошо.

Результаты wrk2:
```
Running 30s test @ http://127.0.0.1:8080
     4 threads and 16 connections
     Thread calibration: mean lat.: 1.296ms, rate sampling interval: 10ms
     Thread calibration: mean lat.: 1.281ms, rate sampling interval: 10ms
     Thread calibration: mean lat.: 1.300ms, rate sampling interval: 10ms
     Thread calibration: mean lat.: 1.283ms, rate sampling interval: 10ms
     Thread Stats   Avg      Stdev     Max   +/- Stdev
       Latency     1.21ms  576.10us  10.69ms   67.49%
       Req/Sec     2.63k   182.75     3.91k    73.52%
     Latency Distribution (HdrHistogram - Recorded Latency)
    50.000%    1.15ms
    75.000%    1.59ms
    90.000%    1.96ms
    99.000%    2.63ms
    99.900%    3.97ms
    99.990%    7.99ms
    99.999%    9.91ms
   100.000%   10.69ms
     Detailed Percentile spectrum:
          Value   Percentile   TotalCount 1/(1-Percentile)
          0.061     0.000000            1         1.00
          0.508     0.100000        20007         1.11
          0.688     0.200000        40094         1.25
          0.843     0.300000        59941         1.43
          0.996     0.400000        80020         1.67
          1.154     0.500000        99959         2.00
          1.233     0.550000       109936         2.22
          1.316     0.600000       119902         2.50
          1.402     0.650000       129922         2.86
          1.491     0.700000       139857         3.33
          1.585     0.750000       149853         4.00
          1.636     0.775000       154850         4.44
          1.691     0.800000       159890         5.00
          1.748     0.825000       164877         5.71
          1.809     0.850000       169839         6.67
          1.878     0.875000       174841         8.00
          1.915     0.887500       177352         8.89
          1.955     0.900000       179834        10.00
          2.000     0.912500       182328        11.43
          2.053     0.925000       184896        13.33
          2.107     0.937500       187329        16.00
          2.141     0.943750       188603        17.78
          2.175     0.950000       189809        20.00
          2.213     0.956250       191052        22.86
          2.257     0.962500       192293        26.67
          2.311     0.968750       193574        32.00
          2.341     0.971875       194166        35.56
          2.375     0.975000       194812        40.00
          2.415     0.978125       195443        45.71
          2.455     0.981250       196047        53.33
          2.505     0.984375       196683        64.00
          2.533     0.985938       196980        71.11
          2.567     0.987500       197306        80.00
          2.603     0.989062       197601        91.43
          2.649     0.990625       197918       106.67
          2.703     0.992188       198232       128.00
          2.735     0.992969       198382       142.22
          2.773     0.993750       198539       160.00
          2.815     0.994531       198700       182.86
          2.865     0.995313       198850       213.33
          2.933     0.996094       199005       256.00
          2.977     0.996484       199082       284.44
          3.023     0.996875       199160       320.00
          3.087     0.997266       199238       365.71
          3.167     0.997656       199316       426.67
          3.283     0.998047       199394       512.00
          3.389     0.998242       199433       568.89
          3.479     0.998437       199473       640.00
          3.589     0.998633       199512       731.43
          3.731     0.998828       199550       853.33
          3.989     0.999023       199589      1024.00
          4.127     0.999121       199611      1137.78
          4.287     0.999219       199628      1280.00
          4.443     0.999316       199648      1462.86
          4.791     0.999414       199667      1706.67
          5.111     0.999512       199687      2048.00
          5.343     0.999561       199697      2275.56
          5.527     0.999609       199706      2560.00
          5.771     0.999658       199716      2925.71
          6.087     0.999707       199726      3413.33
          6.331     0.999756       199736      4096.00
          6.527     0.999780       199741      4551.11
          6.671     0.999805       199745      5120.00
          6.951     0.999829       199750      5851.43
          7.323     0.999854       199755      6826.67
          7.623     0.999878       199760      8192.00
          7.903     0.999890       199763      9102.22
          8.055     0.999902       199765     10240.00
          8.163     0.999915       199767     11702.86
          8.903     0.999927       199770     13653.33
          8.943     0.999939       199772     16384.00
          9.303     0.999945       199774     18204.44
          9.407     0.999951       199775     20480.00
          9.415     0.999957       199776     23405.71
          9.455     0.999963       199777     27306.67
          9.487     0.999969       199778     32768.00
          9.535     0.999973       199779     36408.89
          9.655     0.999976       199780     40960.00
          9.655     0.999979       199780     46811.43
          9.679     0.999982       199781     54613.33
          9.679     0.999985       199781     65536.00
          9.911     0.999986       199782     72817.78
          9.911     0.999988       199782     81920.00
          9.911     0.999989       199782     93622.86
         10.319     0.999991       199783    109226.67
         10.319     0.999992       199783    131072.00
         10.319     0.999993       199783    145635.56
         10.319     0.999994       199783    163840.00
         10.319     0.999995       199783    187245.71
         10.695     0.999995       199784    218453.33
         10.695     1.000000       199784          inf
   #[Mean    =        1.205, StdDeviation   =        0.576]
   #[Max     =       10.688, Total count    =       199784]
   #[Buckets =           27, SubBuckets     =         2048]
   ----------------------------------------------------------
     299906 requests in 30.00s, 19.16MB read
   Requests/sec:   9997.18
   Transfer/sec:    654.11KB
```
Итоги:
* обработали всего 299906 запросов
* прочитали 19.16MB каких-то данных (заголовки и прочее)
* за 0.061 миллисекунд обработали 1ый запрос
* за 10.695 миллисекунд обработали 199784 запросов
* сервер обрабатывал 9997.18 запросов в секунду 

### 2
В лекции просили примерно рассчитать максимально возможную пропускную способность, которую еще будет успевать 
обрабатывать машина. Для этого несколько раз запустила с 100.000 запросов в секунду, и вот что вышло (в порядке 
убывания):
- Requests/sec: 43674.63
- Requests/sec: 43261.38
- Requests/sec: 40637.30
- Requests/sec: 38248.18
- Requests/sec: 35890.76

Чтобы немного перестраховаться возьмем 32000 запросов в секунду. Наш сервер их гарантированно обрабатывает.

Запускаю wrk c такими параметрами:
+ 4 threads (worker) send requests
+ keeping 16 HTTP connections open
+ 30 seconds
+ constant throughput of 32000 requests per second

Результаты с async profiler-а (CPU):
![Flame graph from async profiler](put-cpu-4-16-30-32000.svg?raw=true "Flame graph from async profiler")

Результаты с async profiler-а (ALLOC):
![Flame graph from async profiler](put-alloc-4-16-30-32000.svg?raw=true "Flame graph from async profiler")

Картина одинаковая.

Результаты wrk2:
```
Running 30s test @ http://127.0.0.1:8080
  4 threads and 16 connections
  Thread calibration: mean lat.: 13.516ms, rate sampling interval: 28ms
  Thread calibration: mean lat.: 15.416ms, rate sampling interval: 44ms
  Thread calibration: mean lat.: 3.109ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 3.739ms, rate sampling interval: 10ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   103.85ms  447.64ms   3.56s    95.98%
    Req/Sec     8.29k     1.21k   13.56k    74.05%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.93ms
 75.000%   22.51ms
 90.000%   63.94ms
 99.000%    2.70s 
 99.900%    3.33s 
 99.990%    3.55s 
 99.999%    3.56s 
100.000%    3.57s 
  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)
       0.076     0.000000            1         1.00
       0.527     0.100000        62725         1.11
       0.784     0.200000       125123         1.25
       1.051     0.300000       187536         1.43
       1.391     0.400000       250036         1.67
       1.931     0.500000       312491         2.00
       2.459     0.550000       343796         2.22
       3.921     0.600000       374987         2.50
       8.115     0.650000       406223         2.86
      15.015     0.700000       437503         3.33
      22.511     0.750000       468713         4.00
      27.151     0.775000       484377         4.44
      31.343     0.800000       500007         5.00
      36.543     0.825000       515631         5.71
      43.263     0.850000       531213         6.67
      52.383     0.875000       546858         8.00
      58.079     0.887500       554665         8.89
      63.935     0.900000       562486        10.00
      76.031     0.912500       570285        11.43
      98.687     0.925000       578079        13.33
     130.751     0.937500       585895        16.00
     168.703     0.943750       589799        17.78
     248.959     0.950000       593702        20.00
     348.671     0.956250       597608        22.86
     884.223     0.962500       601517        26.67
    1500.159     0.968750       605424        32.00
    1800.191     0.971875       607374        35.56
    2068.479     0.975000       609336        40.00
    2164.735     0.978125       611296        45.71
    2355.199     0.981250       613235        53.33
    2510.847     0.984375       615229        64.00
    2551.807     0.985938       616181        71.11
    2639.871     0.987500       617141        80.00
    2674.687     0.989062       618147        91.43
    2703.359     0.990625       619125       106.67
    2744.319     0.992188       620094       128.00
    2787.327     0.992969       620561       142.22
    2922.495     0.993750       621051       160.00
    2961.407     0.994531       621536       182.86
    3055.615     0.995313       622047       213.33
    3100.671     0.996094       622521       256.00
    3112.959     0.996484       622764       284.44
    3149.823     0.996875       622999       320.00
    3201.023     0.997266       623253       365.71
    3244.031     0.997656       623487       426.67
    3274.751     0.998047       623780       512.00
    3280.895     0.998242       623874       568.89
    3297.279     0.998437       623994       640.00
    3311.615     0.998633       624118       731.43
    3325.951     0.998828       624221       853.33
    3334.143     0.999023       624377      1024.00
    3340.287     0.999121       624409      1137.78
    3346.431     0.999219       624473      1280.00
    3352.575     0.999316       624529      1462.86
    3381.247     0.999414       624584      1706.67
    3422.207     0.999512       624647      2048.00
    3434.495     0.999561       624678      2275.56
    3452.927     0.999609       624706      2560.00
    3463.167     0.999658       624736      2925.71
    3479.551     0.999707       624767      3413.33
    3495.935     0.999756       624801      4096.00
    3502.079     0.999780       624812      4551.11
    3508.223     0.999805       624831      5120.00
    3518.463     0.999829       624845      5851.43
    3526.655     0.999854       624861      6826.67
    3534.847     0.999878       624873      8192.00
    3540.991     0.999890       624883      9102.22
    3545.087     0.999902       624891     10240.00
    3547.135     0.999915       624900     11702.86
    3549.183     0.999927       624909     13653.33
    3551.231     0.999939       624914     16384.00
    3553.279     0.999945       624919     18204.44
    3553.279     0.999951       624919     20480.00
    3555.327     0.999957       624924     23405.71
    3557.375     0.999963       624928     27306.67
    3559.423     0.999969       624937     32768.00
    3559.423     0.999973       624937     36408.89
    3559.423     0.999976       624937     40960.00
    3559.423     0.999979       624937     46811.43
    3561.471     0.999982       624941     54613.33
    3561.471     0.999985       624941     65536.00
    3561.471     0.999986       624941     72817.78
    3563.519     0.999988       624945     81920.00
    3563.519     0.999989       624945     93622.86
    3563.519     0.999991       624945    109226.67
    3563.519     0.999992       624945    131072.00
    3563.519     0.999993       624945    145635.56
    3565.567     0.999994       624949    163840.00
    3565.567     1.000000       624949          inf
#[Mean    =      103.852, StdDeviation   =      447.641]
#[Max     =     3563.520, Total count    =       624949]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  945306 requests in 30.00s, 60.40MB read
Requests/sec:  31510.72
Transfer/sec:      2.01MB
```

Итоги:
* обработали всего 945306 запросов
* прочитали 60.40MB каких-то данных (заголовки и прочее)
* за 0.076 миллисекунд обработали 1ый запрос
* за 3.565567 секунд обработали 624949 запросов
* сервер обрабатывал 31510.72 запросов в секунду (чуток не успевал)





## GET
### 1
Посмотрим на картину профилирования, если будем пытаться забрать несуществующие ключи (все ответы возвращает 404).

Запускаю wrk c такими параметрами:
+ 4 threads (worker) send requests
+ keeping 16 HTTP connections open
+ 30 seconds
+ constant throughput of 10000 requests per second

Результаты с async profiler-а (CPU):
![Flame graph from async profiler](404-get-cpu-4-16-30-10000.svg?raw=true "Flame graph from async profiler")

Результаты с async profiler-а (ALLOC):
![Flame graph from async profiler](404-get-alloc-4-16-30-10000.svg?raw=true "Flame graph from async profiler")

Результаты с async profiler-а (LOCK):
![Flame graph from async profiler](404-get-lock-4-16-30-10000.svg?raw=true "Flame graph from async profiler")

Результаты wrk2:
```
Running 30s test @ http://127.0.0.1:8080
  4 threads and 16 connections
  Thread calibration: mean lat.: 1.639ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 1.634ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 1.841ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 1.715ms, rate sampling interval: 10ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     2.35ms    5.31ms  67.90ms   94.64%
    Req/Sec     2.65k   423.54     8.33k    88.26%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.21ms
 75.000%    1.70ms
 90.000%    2.62ms
 99.000%   30.56ms
 99.900%   57.66ms
 99.990%   65.98ms
 99.999%   67.52ms
100.000%   67.97ms
  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)
       0.069     0.000000            1         1.00
       0.502     0.100000        20053         1.11
       0.698     0.200000        40035         1.25
       0.873     0.300000        59951         1.43
       1.042     0.400000        79991         1.67
       1.208     0.500000        99935         2.00
       1.293     0.550000       109955         2.22
       1.382     0.600000       119957         2.50
       1.476     0.650000       129886         2.86
       1.578     0.700000       139926         3.33
       1.696     0.750000       149881         4.00
       1.765     0.775000       154898         4.44
       1.842     0.800000       159880         5.00
       1.938     0.825000       164831         5.71
       2.059     0.850000       169859         6.67
       2.243     0.875000       174856         8.00
       2.387     0.887500       177339         8.89
       2.617     0.900000       179825        10.00
       3.059     0.912500       182320        11.43
       3.999     0.925000       184811        13.33
       5.815     0.937500       187308        16.00
       7.047     0.943750       188559        17.78
       8.519     0.950000       189805        20.00
      10.215     0.956250       191054        22.86
      12.351     0.962500       192306        26.67
      15.063     0.968750       193553        32.00
      16.559     0.971875       194175        35.56
      18.111     0.975000       194803        40.00
      19.855     0.978125       195424        45.71
      21.935     0.981250       196052        53.33
      24.479     0.984375       196674        64.00
      26.047     0.985938       196985        71.11
      27.631     0.987500       197299        80.00
      29.391     0.989062       197609        91.43
      31.327     0.990625       197922       106.67
      33.311     0.992188       198238       128.00
      34.271     0.992969       198391       142.22
      35.519     0.993750       198546       160.00
      37.279     0.994531       198702       182.86
      39.519     0.995313       198858       213.33
      42.719     0.996094       199015       256.00
      44.447     0.996484       199092       284.44
      46.143     0.996875       199171       320.00
      47.647     0.997266       199248       365.71
      48.959     0.997656       199327       426.67
      50.847     0.998047       199404       512.00
      52.031     0.998242       199443       568.89
      53.279     0.998437       199484       640.00
      54.943     0.998633       199521       731.43
      56.287     0.998828       199560       853.33
      57.823     0.999023       199599      1024.00
      58.815     0.999121       199619      1137.78
      59.423     0.999219       199638      1280.00
      60.319     0.999316       199659      1462.86
      60.991     0.999414       199678      1706.67
      61.759     0.999512       199697      2048.00
      62.015     0.999561       199707      2275.56
      62.559     0.999609       199716      2560.00
      63.007     0.999658       199726      2925.71
      63.359     0.999707       199737      3413.33
      63.807     0.999756       199746      4096.00
      64.127     0.999780       199752      4551.11
      64.415     0.999805       199756      5120.00
      64.575     0.999829       199760      5851.43
      64.991     0.999854       199765      6826.67
      65.599     0.999878       199770      8192.00
      65.855     0.999890       199773      9102.22
      66.111     0.999902       199775     10240.00
      66.175     0.999915       199777     11702.86
      66.303     0.999927       199780     13653.33
      66.431     0.999939       199782     16384.00
      66.559     0.999945       199784     18204.44
      66.751     0.999951       199785     20480.00
      66.879     0.999957       199787     23405.71
      66.879     0.999963       199787     27306.67
      66.943     0.999969       199788     32768.00
      67.007     0.999973       199789     36408.89
      67.327     0.999976       199791     40960.00
      67.327     0.999979       199791     46811.43
      67.327     0.999982       199791     54613.33
      67.327     0.999985       199791     65536.00
      67.519     0.999986       199792     72817.78
      67.519     0.999988       199792     81920.00
      67.519     0.999989       199792     93622.86
      67.711     0.999991       199793    109226.67
      67.711     0.999992       199793    131072.00
      67.711     0.999993       199793    145635.56
      67.711     0.999994       199793    163840.00
      67.711     0.999995       199793    187245.71
      67.967     0.999995       199794    218453.33
      67.967     1.000000       199794          inf
#[Mean    =        2.354, StdDeviation   =        5.310]
#[Max     =       67.904, Total count    =       199794]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  299919 requests in 30.00s, 19.74MB read
  Non-2xx or 3xx responses: 299919
Requests/sec:   9997.33
Transfer/sec:    673.65KB
```

Итоги:
* обработали всего 299919 запросов и все они вернули 404
* прочитали 19.74MB каких-то данных (заголовки и прочее)
* за 0.069 миллисекунд обработали 1ый запрос
* за 67.967 миллисекунд  обработали 199794 запросов
* сервер обрабатывал 9997.33 запросов в секунду 

### 2
Запускаю wrk c такими параметрами:
+ 4 threads (worker) send requests
+ keeping 16 HTTP connections open
+ 1 minutes 
+ constant throughput of 70000 requests per second

Результаты wrk2:
```
Running 1m test @ http://127.0.0.1:8080
  4 threads and 16 connections
  Thread calibration: mean lat.: 119.438ms, rate sampling interval: 821ms
  Thread calibration: mean lat.: 143.397ms, rate sampling interval: 915ms
  Thread calibration: mean lat.: 109.803ms, rate sampling interval: 763ms
  Thread calibration: mean lat.: 125.750ms, rate sampling interval: 846ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     6.13s     3.66s   14.02s    58.37%
    Req/Sec    13.51k     1.30k   17.28k    72.27%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    6.38s 
 75.000%    9.15s 
 90.000%   11.03s 
 99.000%   13.18s 
 99.900%   13.84s 
 99.990%   14.01s 
 99.999%   14.02s 
100.000%   14.02s 
  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)
     419.071     0.000000            1         1.00
    1076.223     0.100000       270104         1.11
    2244.607     0.200000       540291         1.25
    3229.695     0.300000       810247         1.43
    4775.935     0.400000      1080004         1.67
    6381.567     0.500000      1350617         2.00
    6983.679     0.550000      1485590         2.22
    7524.351     0.600000      1619923         2.50
    8069.119     0.650000      1755758         2.86
    8593.407     0.700000      1890158         3.33
    9150.463     0.750000      2026394         4.00
    9420.799     0.775000      2092504         4.44
    9723.903     0.800000      2161226         5.00
   10002.431     0.825000      2228435         5.71
   10330.111     0.850000      2295689         6.67
   10674.175     0.875000      2362752         8.00
   10846.207     0.887500      2396699         8.89
   11034.623     0.900000      2431175        10.00
   11239.423     0.912500      2463824        11.43
   11468.799     0.925000      2498374        13.33
   11706.367     0.937500      2532207        16.00
   11829.247     0.943750      2548274        17.78
   11968.511     0.950000      2565185        20.00
   12107.775     0.956250      2582200        22.86
   12271.615     0.962500      2598690        26.67
   12468.223     0.968750      2615793        32.00
   12566.527     0.971875      2624380        35.56
   12664.831     0.975000      2632840        40.00
   12771.327     0.978125      2640923        45.71
   12869.631     0.981250      2649267        53.33
   12976.127     0.984375      2657859        64.00
   13025.279     0.985938      2662231        71.11
   13074.431     0.987500      2666039        80.00
   13139.967     0.989062      2670574        91.43
   13213.695     0.990625      2674741       106.67
   13295.615     0.992188      2678833       128.00
   13352.959     0.992969      2680837       142.22
   13410.303     0.993750      2683016       160.00
   13467.647     0.994531      2685036       182.86
   13524.991     0.995313      2687157       213.33
   13590.527     0.996094      2689496       256.00
   13623.295     0.996484      2690449       284.44
   13647.871     0.996875      2691410       320.00
   13680.639     0.997266      2692653       365.71
   13705.215     0.997656      2693672       426.67
   13737.983     0.998047      2694675       512.00
   13754.367     0.998242      2695137       568.89
   13770.751     0.998437      2695595       640.00
   13795.327     0.998633      2696151       731.43
   13819.903     0.998828      2696758       853.33
   13836.287     0.999023      2697185      1024.00
   13852.671     0.999121      2697540      1137.78
   13869.055     0.999219      2697703      1280.00
   13893.631     0.999316      2697942      1462.86
   13918.207     0.999414      2698225      1706.67
   13934.591     0.999512      2698480      2048.00
   13942.783     0.999561      2698614      2275.56
   13950.975     0.999609      2698730      2560.00
   13967.359     0.999658      2698986      2925.71
   13975.551     0.999707      2699106      3413.33
   13983.743     0.999756      2699231      4096.00
   13983.743     0.999780      2699231      4551.11
   13991.935     0.999805      2699360      5120.00
   13991.935     0.999829      2699360      5851.43
   14000.127     0.999854      2699482      6826.67
   14000.127     0.999878      2699482      8192.00
   14008.319     0.999890      2699610      9102.22
   14008.319     0.999902      2699610     10240.00
   14008.319     0.999915      2699610     11702.86
   14008.319     0.999927      2699610     13653.33
   14016.511     0.999939      2699751     16384.00
   14016.511     0.999945      2699751     18204.44
   14016.511     0.999951      2699751     20480.00
   14016.511     0.999957      2699751     23405.71
   14016.511     0.999963      2699751     27306.67
   14016.511     0.999969      2699751     32768.00
   14016.511     0.999973      2699751     36408.89
   14016.511     0.999976      2699751     40960.00
   14016.511     0.999979      2699751     46811.43
   14016.511     0.999982      2699751     54613.33
   14016.511     0.999985      2699751     65536.00
   14016.511     0.999986      2699751     72817.78
   14016.511     0.999988      2699751     81920.00
   14024.703     0.999989      2699783     93622.86
   14024.703     1.000000      2699783          inf
#[Mean    =     6132.964, StdDeviation   =     3659.853]
#[Max     =    14016.512, Total count    =      2699783]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  3355543 requests in 1.00m, 217.18MB read
Requests/sec:  55926.46
Transfer/sec:      3.62MB
```

Итоги:
* обработали всего 3355543 запросов
* прочитали 217.18MB данных 
* за 419.071 миллисекунд обработали 1ый запрос
* за 14.024703 секунд  обработали 2699783 запросов
* сервер обрабатывал 55926.46 запросов в секунду 


### 3
Запускаю wrk c такими параметрами:
+ 4 threads (worker) send requests
+ keeping 16 HTTP connections open
+ 30 seconds
+ constant throughput of 10000 requests per second

Результаты с async profiler-а (CPU):
![Flame graph from async profiler](get-cpu-4-16-30-10000.svg?raw=true "Flame graph from async profiler")

Результаты с async profiler-а (ALLOC):
![Flame graph from async profiler](get-alloc-4-16-30-10000.svg?raw=true "Flame graph from async profiler")

Результаты с async profiler-а (LOCK):
![Flame graph from async profiler](get-lock-4-16-30-10000.svg?raw=true "Flame graph from async profiler")
Также пусто.

Результаты wrk2:
```
Running 30s test @ http://127.0.0.1:8080
  4 threads and 16 connections
  Thread calibration: mean lat.: 1.279ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 1.275ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 1.266ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 1.279ms, rate sampling interval: 10ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     1.27ms  554.03us   4.69ms   64.95%
    Req/Sec     2.64k   187.33     3.44k    70.60%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.23ms
 75.000%    1.66ms
 90.000%    2.03ms
 99.000%    2.58ms
 99.900%    2.94ms
 99.990%    3.55ms
 99.999%    4.44ms
100.000%    4.70ms
  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)
       0.063     0.000000            1         1.00
       0.564     0.100000        20067         1.11
       0.758     0.200000        40034         1.25
       0.918     0.300000        59947         1.43
       1.073     0.400000        80006         1.67
       1.228     0.500000        99949         2.00
       1.308     0.550000       109894         2.22
       1.390     0.600000       119964         2.50
       1.476     0.650000       129858         2.86
       1.565     0.700000       139894         3.33
       1.663     0.750000       149928         4.00
       1.714     0.775000       154869         4.44
       1.767     0.800000       159882         5.00
       1.824     0.825000       164819         5.71
       1.886     0.850000       169871         6.67
       1.953     0.875000       174868         8.00
       1.990     0.887500       177374         8.89
       2.028     0.900000       179832        10.00
       2.071     0.912500       182301        11.43
       2.119     0.925000       184860        13.33
       2.171     0.937500       187325        16.00
       2.201     0.943750       188545        17.78
       2.233     0.950000       189846        20.00
       2.267     0.956250       191111        22.86
       2.303     0.962500       192321        26.67
       2.347     0.968750       193558        32.00
       2.371     0.971875       194175        35.56
       2.399     0.975000       194826        40.00
       2.427     0.978125       195431        45.71
       2.457     0.981250       196047        53.33
       2.491     0.984375       196662        64.00
       2.511     0.985938       196973        71.11
       2.533     0.987500       197286        80.00
       2.557     0.989062       197596        91.43
       2.587     0.990625       197917       106.67
       2.617     0.992188       198226       128.00
       2.635     0.992969       198381       142.22
       2.655     0.993750       198531       160.00
       2.679     0.994531       198687       182.86
       2.707     0.995313       198852       213.33
       2.737     0.996094       199002       256.00
       2.759     0.996484       199076       284.44
       2.775     0.996875       199156       320.00
       2.793     0.997266       199232       365.71
       2.815     0.997656       199311       426.67
       2.845     0.998047       199391       512.00
       2.863     0.998242       199428       568.89
       2.883     0.998437       199472       640.00
       2.899     0.998633       199509       731.43
       2.915     0.998828       199545       853.33
       2.951     0.999023       199584      1024.00
       2.961     0.999121       199605      1137.78
       2.973     0.999219       199622      1280.00
       2.993     0.999316       199642      1462.86
       3.023     0.999414       199661      1706.67
       3.061     0.999512       199681      2048.00
       3.087     0.999561       199691      2275.56
       3.111     0.999609       199701      2560.00
       3.143     0.999658       199710      2925.71
       3.171     0.999707       199720      3413.33
       3.233     0.999756       199730      4096.00
       3.291     0.999780       199735      4551.11
       3.333     0.999805       199739      5120.00
       3.375     0.999829       199745      5851.43
       3.459     0.999854       199749      6826.67
       3.519     0.999878       199754      8192.00
       3.545     0.999890       199757      9102.22
       3.575     0.999902       199759     10240.00
       3.595     0.999915       199761     11702.86
       3.665     0.999927       199764     13653.33
       3.715     0.999939       199766     16384.00
       3.735     0.999945       199768     18204.44
       3.767     0.999951       199769     20480.00
       3.797     0.999957       199770     23405.71
       3.947     0.999963       199771     27306.67
       3.967     0.999969       199772     32768.00
       4.041     0.999973       199773     36408.89
       4.139     0.999976       199774     40960.00
       4.139     0.999979       199774     46811.43
       4.399     0.999982       199775     54613.33
       4.399     0.999985       199775     65536.00
       4.439     0.999986       199776     72817.78
       4.439     0.999988       199776     81920.00
       4.439     0.999989       199776     93622.86
       4.535     0.999991       199777    109226.67
       4.535     0.999992       199777    131072.00
       4.535     0.999993       199777    145635.56
       4.535     0.999994       199777    163840.00
       4.535     0.999995       199777    187245.71
       4.695     0.999995       199778    218453.33
       4.695     1.000000       199778          inf
#[Mean    =        1.269, StdDeviation   =        0.554]
#[Max     =        4.692, Total count    =       199778]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  297417 requests in 30.00s, 18.96MB read
Requests/sec:   9914.08
Transfer/sec:    647.23KB
```

Итоги:
* обработали всего 297417 запросов
* прочитали 18.96MB каких-то данных 
* за 0.063 миллисекунд обработали 1ый запрос
* за 4.695 миллисекунды  обработали 199778 запросов
* сервер обрабатывал 9914.08 запросов в секунду 