# Нагрузочное тестирование
## Запрос put
### wrk

Параметры запуска

```
./wrk -t1 -c1 -d40s -R2000 -s put.lua --latency http://127.0.0.1:8080

```

Полученный результат

```
Running 40s test @ http://127.0.0.1:8080
  1 threads and 1 connections
  Thread calibration: mean lat.: 2.331ms, rate sampling interval: 10ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     1.38ms  805.71us  11.61ms   71.94%
    Req/Sec     2.12k   282.31     4.44k    71.21%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.28ms
 75.000%    1.85ms
 90.000%    2.32ms
 99.000%    3.37ms
 99.900%    7.88ms
 99.990%   10.58ms
 99.999%   11.49ms
100.000%   11.61ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.115     0.000000            1         1.00
       0.448     0.100000         6018         1.11
       0.705     0.200000        12002         1.25
       0.938     0.300000        18023         1.43
       1.111     0.400000        24036         1.67
       1.284     0.500000        30021         2.00
       1.391     0.550000        32999         2.22
       1.501     0.600000        35997         2.50
       1.619     0.650000        39006         2.86
       1.731     0.700000        42011         3.33
       1.848     0.750000        45007         4.00
       1.910     0.775000        46494         4.44
       1.972     0.800000        47999         5.00
       2.038     0.825000        49495         5.71
       2.119     0.850000        51020         6.67
       2.215     0.875000        52517         8.00
       2.269     0.887500        53253         8.89
       2.321     0.900000        54002        10.00
       2.379     0.912500        54757        11.43
       2.449     0.925000        55508        13.33
       2.525     0.937500        56251        16.00
       2.569     0.943750        56632        17.78
       2.609     0.950000        57002        20.00
       2.653     0.956250        57380        22.86
       2.703     0.962500        57754        26.67
       2.763     0.968750        58121        32.00
       2.795     0.971875        58309        35.56
       2.839     0.975000        58496        40.00
       2.883     0.978125        58681        45.71
       2.941     0.981250        58870        53.33
       3.031     0.984375        59055        64.00
       3.091     0.985938        59148        71.11
       3.163     0.987500        59244        80.00
       3.269     0.989062        59334        91.43
       3.477     0.990625        59428       106.67
       3.943     0.992188        59523       128.00
       4.219     0.992969        59569       142.22
       4.519     0.993750        59616       160.00
       4.823     0.994531        59662       182.86
       5.159     0.995313        59709       213.33
       5.595     0.996094        59756       256.00
       5.767     0.996484        59780       284.44
       5.955     0.996875        59803       320.00
       6.203     0.997266        59826       365.71
       6.419     0.997656        59850       426.67
       6.759     0.998047        59873       512.00
       6.951     0.998242        59885       568.89
       7.163     0.998437        59897       640.00
       7.403     0.998633        59908       731.43
       7.647     0.998828        59920       853.33
       7.923     0.999023        59932      1024.00
       8.131     0.999121        59939      1137.78
       8.303     0.999219        59944      1280.00
       8.431     0.999316        59949      1462.86
       8.687     0.999414        59955      1706.67
       8.991     0.999512        59961      2048.00
       9.063     0.999561        59964      2275.56
       9.247     0.999609        59967      2560.00
       9.439     0.999658        59970      2925.71
       9.639     0.999707        59973      3413.33
       9.927     0.999756        59976      4096.00
       9.943     0.999780        59977      4551.11
      10.239     0.999805        59979      5120.00
      10.255     0.999829        59980      5851.43
      10.479     0.999854        59982      6826.67
      10.583     0.999878        59984      8192.00
      10.583     0.999890        59984      9102.22
      10.847     0.999902        59985     10240.00
      10.847     0.999915        59985     11702.86
      11.103     0.999927        59986     13653.33
      11.271     0.999939        59987     16384.00
      11.271     0.999945        59987     18204.44
      11.295     0.999951        59988     20480.00
      11.295     0.999957        59988     23405.71
      11.295     0.999963        59988     27306.67
      11.487     0.999969        59989     32768.00
      11.487     0.999973        59989     36408.89
      11.487     0.999976        59989     40960.00
      11.487     0.999979        59989     46811.43
      11.487     0.999982        59989     54613.33
      11.615     0.999985        59990     65536.00
      11.615     1.000000        59990          inf
#[Mean    =        1.382, StdDeviation   =        0.806]
#[Max     =       11.608, Total count    =        59990]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  79999 requests in 40.00s, 5.11MB read
Requests/sec:   1999.97
Transfer/sec:    130.86KB
```
### Async-profiler 
![alt text](https://raw.githubusercontent.com/IvanovAndrey/2020-highload-dht/a6f0772b3633074a3d336bb97f0fee62294f4034/async/put_cpu.svg)

### Allocation
![alt text](https://raw.githubusercontent.com/IvanovAndrey/2020-highload-dht/a6f0772b3633074a3d336bb97f0fee62294f4034/async/alloc-put.svg)


## Запрос get
### wrk

Параметры запуска

```
./wrk -t1 -c1 -d40s -R2000 -s get.lua --latency http://127.0.0.1:8080

```

Полученный результат

```
Running 40s test @ http://127.0.0.1:8080
  1 threads and 1 connections
  Thread calibration: mean lat.: 10.314ms, rate sampling interval: 10ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     1.37ms  777.31us  10.31ms   69.77%
    Req/Sec     2.12k   263.95     3.56k    67.86%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.28ms
 75.000%    1.85ms
 90.000%    2.32ms
 99.000%    3.22ms
 99.900%    7.31ms
 99.990%    9.46ms
 99.999%   10.09ms
100.000%   10.32ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.105     0.000000            1         1.00
       0.430     0.100000         6001         1.11
       0.695     0.200000        12016         1.25
       0.924     0.300000        18028         1.43
       1.096     0.400000        24040         1.67
       1.276     0.500000        30016         2.00
       1.384     0.550000        33005         2.22
       1.498     0.600000        35996         2.50
       1.617     0.650000        38997         2.86
       1.729     0.700000        42001         3.33
       1.845     0.750000        45007         4.00
       1.906     0.775000        46495         4.44
       1.972     0.800000        47999         5.00
       2.041     0.825000        49517         5.71
       2.121     0.850000        51000         6.67
       2.215     0.875000        52499         8.00
       2.269     0.887500        53252         8.89
       2.323     0.900000        54008        10.00
       2.381     0.912500        54754        11.43
       2.441     0.925000        55493        13.33
       2.507     0.937500        56243        16.00
       2.547     0.943750        56626        17.78
       2.589     0.950000        56994        20.00
       2.635     0.956250        57377        22.86
       2.685     0.962500        57747        26.67
       2.743     0.968750        58129        32.00
       2.769     0.971875        58310        35.56
       2.811     0.975000        58495        40.00
       2.849     0.978125        58679        45.71
       2.917     0.981250        58872        53.33
       2.995     0.984375        59060        64.00
       3.043     0.985938        59149        71.11
       3.097     0.987500        59245        80.00
       3.163     0.989062        59336        91.43
       3.259     0.990625        59430       106.67
       3.435     0.992188        59523       128.00
       3.655     0.992969        59570       142.22
       3.879     0.993750        59617       160.00
       4.159     0.994531        59664       182.86
       4.471     0.995313        59711       213.33
       4.835     0.996094        59758       256.00
       5.095     0.996484        59781       284.44
       5.283     0.996875        59804       320.00
       5.551     0.997266        59827       365.71
       5.827     0.997656        59851       426.67
       6.139     0.998047        59874       512.00
       6.311     0.998242        59886       568.89
       6.527     0.998437        59898       640.00
       6.731     0.998633        59909       731.43
       7.019     0.998828        59921       853.33
       7.311     0.999023        59933      1024.00
       7.407     0.999121        59939      1137.78
       7.647     0.999219        59945      1280.00
       7.771     0.999316        59950      1462.86
       8.019     0.999414        59956      1706.67
       8.167     0.999512        59962      2048.00
       8.303     0.999561        59965      2275.56
       8.367     0.999609        59968      2560.00
       8.503     0.999658        59971      2925.71
       8.647     0.999707        59974      3413.33
       8.791     0.999756        59977      4096.00
       9.015     0.999780        59978      4551.11
       9.127     0.999805        59980      5120.00
       9.327     0.999829        59981      5851.43
       9.367     0.999854        59983      6826.67
       9.383     0.999878        59984      8192.00
       9.463     0.999890        59985      9102.22
       9.727     0.999902        59987     10240.00
       9.727     0.999915        59987     11702.86
       9.727     0.999927        59987     13653.33
       9.799     0.999939        59988     16384.00
       9.799     0.999945        59988     18204.44
      10.063     0.999951        59989     20480.00
      10.063     0.999957        59989     23405.71
      10.063     0.999963        59989     27306.67
      10.087     0.999969        59990     32768.00
      10.087     0.999973        59990     36408.89
      10.087     0.999976        59990     40960.00
      10.087     0.999979        59990     46811.43
      10.087     0.999982        59990     54613.33
      10.319     0.999985        59991     65536.00
      10.319     1.000000        59991          inf
#[Mean    =        1.367, StdDeviation   =        0.777]
#[Max     =       10.312, Total count    =        59991]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  79999 requests in 40.00s, 5.10MB read
Requests/sec:   1999.97
Transfer/sec:    130.59KB
```
### Async-profiler 
![alt text](https://raw.githubusercontent.com/IvanovAndrey/2020-highload-dht/1ac275987145b5d79f4fc9e83939f61bda8261f9/async/get_cpu.svg)

### Allocation
![alt text](https://raw.githubusercontent.com/IvanovAndrey/2020-highload-dht/a6f0772b3633074a3d336bb97f0fee62294f4034/async/alloc-get.svg)

## Запрос delete
### wrk

Параметры запуска

```
./wrk -t1 -c1 -d40s -R2000 -s delete.lua --latency http://127.0.0.1:8080

```

Полученный результат

```
Running 40s test @ http://127.0.0.1:8080
  1 threads and 1 connections
  Thread calibration: mean lat.: 1.814ms, rate sampling interval: 10ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     1.40ms    1.07ms  22.67ms   87.45%
    Req/Sec     2.12k   285.38     5.44k    72.48%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.27ms
 75.000%    1.84ms
 90.000%    2.32ms
 99.000%    3.51ms
 99.900%   15.76ms
 99.990%   21.85ms
 99.999%   22.50ms
100.000%   22.69ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.114     0.000000            1         1.00
       0.444     0.100000         6012         1.11
       0.697     0.200000        12020         1.25
       0.932     0.300000        18015         1.43
       1.103     0.400000        24002         1.67
       1.272     0.500000        30025         2.00
       1.379     0.550000        33006         2.22
       1.494     0.600000        36016         2.50
       1.604     0.650000        39001         2.86
       1.722     0.700000        41996         3.33
       1.839     0.750000        44998         4.00
       1.899     0.775000        46511         4.44
       1.963     0.800000        48013         5.00
       2.034     0.825000        49507         5.71
       2.113     0.850000        51010         6.67
       2.205     0.875000        52493         8.00
       2.261     0.887500        53251         8.89
       2.315     0.900000        54003        10.00
       2.375     0.912500        54756        11.43
       2.439     0.925000        55491        13.33
       2.517     0.937500        56267        16.00
       2.559     0.943750        56621        17.78
       2.605     0.950000        57004        20.00
       2.651     0.956250        57372        22.86
       2.701     0.962500        57749        26.67
       2.759     0.968750        58115        32.00
       2.799     0.971875        58304        35.56
       2.839     0.975000        58490        40.00
       2.897     0.978125        58680        45.71
       2.967     0.981250        58866        53.33
       3.051     0.984375        59053        64.00
       3.123     0.985938        59146        71.11
       3.217     0.987500        59241        80.00
       3.335     0.989062        59335        91.43
       3.643     0.990625        59427       106.67
       4.111     0.992188        59521       128.00
       4.419     0.992969        59569       142.22
       4.767     0.993750        59615       160.00
       5.275     0.994531        59661       182.86
       6.207     0.995313        59708       213.33
       7.739     0.996094        59755       256.00
       8.607     0.996484        59779       284.44
       9.543     0.996875        59802       320.00
      10.751     0.997266        59825       365.71
      11.879     0.997656        59849       426.67
      12.831     0.998047        59872       512.00
      13.279     0.998242        59884       568.89
      13.823     0.998437        59896       640.00
      14.551     0.998633        59907       731.43
      15.279     0.998828        59919       853.33
      15.767     0.999023        59931      1024.00
      16.063     0.999121        59937      1137.78
      16.399     0.999219        59943      1280.00
      16.687     0.999316        59948      1462.86
      17.183     0.999414        59954      1706.67
      18.191     0.999512        59960      2048.00
      18.703     0.999561        59963      2275.56
      19.183     0.999609        59966      2560.00
      19.695     0.999658        59969      2925.71
      20.127     0.999707        59972      3413.33
      20.639     0.999756        59975      4096.00
      20.815     0.999780        59976      4551.11
      21.167     0.999805        59978      5120.00
      21.183     0.999829        59979      5851.43
      21.503     0.999854        59981      6826.67
      21.775     0.999878        59982      8192.00
      21.855     0.999890        59983      9102.22
      22.079     0.999902        59984     10240.00
      22.079     0.999915        59984     11702.86
      22.159     0.999927        59985     13653.33
      22.399     0.999939        59986     16384.00
      22.399     0.999945        59986     18204.44
      22.463     0.999951        59987     20480.00
      22.463     0.999957        59987     23405.71
      22.463     0.999963        59987     27306.67
      22.495     0.999969        59988     32768.00
      22.495     0.999973        59988     36408.89
      22.495     0.999976        59988     40960.00
      22.495     0.999979        59988     46811.43
      22.495     0.999982        59988     54613.33
      22.687     0.999985        59989     65536.00
      22.687     1.000000        59989          inf
#[Mean    =        1.402, StdDeviation   =        1.071]
#[Max     =       22.672, Total count    =        59989]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  79997 requests in 40.00s, 5.19MB read
Requests/sec:   1999.92
Transfer/sec:    132.81KB
```
### Async-profiler 
![alt text](https://raw.githubusercontent.com/IvanovAndrey/2020-highload-dht/a6f0772b3633074a3d336bb97f0fee62294f4034/async/delete_cpu.svg)

### Allocation
![alt text](https://raw.githubusercontent.com/IvanovAndrey/2020-highload-dht/a6f0772b3633074a3d336bb97f0fee62294f4034/async/alloc-delete.svg)
